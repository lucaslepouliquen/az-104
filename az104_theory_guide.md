# AZ-104 Microsoft Azure Administrator - Guide Complet d'Examen

## üìã Table des Mati√®res
1. [Manage Azure Identities and Governance (15-20%)](#1-manage-azure-identities-and-governance)
2. [Implement and Manage Storage (15-20%)](#2-implement-and-manage-storage)
3. [Deploy and Manage Azure Compute Resources (20-25%)](#3-deploy-and-manage-azure-compute-resources)
4. [Configure and Manage Virtual Networking (25-30%)](#4-configure-and-manage-virtual-networking)
5. [Monitor and Backup Azure Resources (10-15%)](#5-monitor-and-backup-azure-resources)

---

## 1. Manage Azure Identities and Governance (15-20%)

### 1.1 Azure Active Directory (Azure AD)

#### Concepts Fondamentaux
- **Tenant** : Instance Azure AD pour une organisation
- **Subscription** : Conteneur de facturation li√© √† un tenant
- **Directory** : Synonyme de tenant Azure AD

#### Utilisateurs et Groupes

**Types d'utilisateurs :**
- **Cloud Identity** : Cr√©√© directement dans Azure AD
- **Directory Synchronized** : Synchronis√© depuis AD on-premises
- **Guest User** : Utilisateur externe (Azure AD B2B)

**Types de groupes :**
- **Security Groups** : Gestion des permissions
- **Microsoft 365 Groups** : Collaboration (Teams, SharePoint, etc.)
- **Distribution Groups** : Listes de diffusion email

#### Membership Types
- **Assigned** : Ajout manuel des membres
- **Dynamic User** : R√®gles bas√©es sur les attributs utilisateur
- **Dynamic Device** : R√®gles bas√©es sur les attributs d'appareil

**üéØ Erreur fr√©quente identifi√©e :** Syntaxe des r√®gles dynamiques
```
// Correct
(user.department -eq "Marketing") and (user.country -eq "France")

// Propri√©t√©s utilisateur courantes
user.department, user.country, user.city, user.jobTitle, user.userPrincipalName
```

#### Custom Domains

**Processus d'ajout :**
1. Ajouter le domaine dans Azure AD
2. Cr√©er un enregistrement DNS pour v√©rification
3. V√©rifier la propri√©t√© du domaine

**üéØ Point d'attention identifi√© :** Types d'enregistrements DNS accept√©s
- **TXT** : M√©thode recommand√©e (plus flexible)
- **MX** : Alternative acceptable
- Exemple : `MS=ms12345678` dans un enregistrement TXT

#### Licensing et Dynamic Groups

**üéØ Processus d'assignation automatique de licences :**
1. **Cr√©er un groupe de s√©curit√© dynamique** bas√© sur des attributs personnalis√©s
2. **Configurer les r√®gles** du groupe dynamique
3. **Ajouter le groupe √† un groupe de licences** pour synchronisation automatique
4. **Tous les utilisateurs** du groupe re√ßoivent automatiquement la licence

**üéØ Points cl√©s identifi√©s :**
- **Dynamic security groups** : Obligatoires pour assignation automatique
- **Custom attributes** : Base des r√®gles de groupe
- **License groups** : Synchronisation automatique requise
- **Automatic assignment policies** : Non utilis√©es pour les licences

#### B2B Collaboration

**üéØ Configuration des param√®tres de collaboration externe :**
- **External collaboration settings** : Contr√¥lent qui peut inviter des utilisateurs externes
- **Domain restrictions** : Autoriser/bloquer des domaines sp√©cifiques
- **Guest user visibility** : Contr√¥ler ce que voient les invit√©s dans l'annuaire
- **Conditional Access** : Renforcer l'authentification et bloquer l'acc√®s depuis des emplacements inconnus
- **Cross-tenant access** : Configuration de collaboration avec des organisations Microsoft Entra sp√©cifiques

**üéØ Format UPN des utilisateurs invit√©s :**
- **Guest users** : `bsmith_contoso.com#EXT#@fabrikam.com`
- **Regular users** : `user@fabrikam.com`
- **Access reviews** : Non utilis√©es pour contr√¥ler les invitations d'invit√©s

**üéØ Pr√©requis pour assignation de licences :**
- **Usage location** : Obligatoire avant assignation de licence
- **Not all Microsoft 365 services** disponibles dans tous les emplacements
- **First name, Last name, Other email, User type** : Non obligatoires pour assignation de licence

### 1.2 Role-Based Access Control (RBAC)

#### R√¥les Built-in Essentiels
- **Owner** : Acc√®s complet + gestion des acc√®s
- **Contributor** : Acc√®s complet sauf gestion des acc√®s
- **Reader** : Lecture seule
- **User Access Administrator** : Gestion des acc√®s uniquement

#### R√¥les Sp√©cialis√©s
- **Virtual Machine Contributor** : Gestion des VMs
- **Storage Account Contributor** : Gestion des comptes de stockage
- **Network Contributor** : Gestion des ressources r√©seau

**üéØ Diff√©renciation des r√¥les essentiels :**

**Contributor**
- **Cr√©ation et gestion** : Tous types de ressources
- **Limitation** : Ne peut pas d√©l√©guer l'acc√®s √† d'autres utilisateurs
- **Usage** : D√©veloppement et administration des ressources

**Reader**
- **Visualisation** : Ressources Azure existantes
- **Aucune action** : Pas d'actions autoris√©es sur les ressources
- **Usage** : Monitoring et audit

**API Management Service Contributor**
- **Scope limit√©** : Services API Management et APIs uniquement
- **Gestion sp√©cialis√©e** : Configuration et maintenance des APIs
- **Usage** : Administration des services API

**Owner**
- **Acc√®s complet** : Toutes les ressources
- **D√©l√©gation** : Possibilit√© de d√©l√©guer l'acc√®s √† d'autres utilisateurs
- **Usage** : Administration compl√®te avec gestion des acc√®s

#### Scopes d'assignation
1. **Management Group** : Niveau le plus √©lev√©
2. **Subscription** : Toutes les ressources de la souscription
3. **Resource Group** : Toutes les ressources du groupe
4. **Resource** : Ressource sp√©cifique

**üéØ Erreur identifi√©e :** Root Management Group
- **Aucun acc√®s par d√©faut** au root management group
- Seuls les **Global Administrators** peuvent s'√©lever
- Process : Global Admin ‚Üí "Access management for Azure resources" ‚Üí Assign roles

### 1.3 Azure Policy

#### Concepts Cl√©s
- **Policy Definition** : R√®gle de conformit√©
- **Policy Assignment** : Application d'une policy √† un scope
- **Initiative** : Collection de policies
- **Compliance** : √âtat de conformit√© des ressources

#### Effects Principaux
- **Deny** : Bloque la cr√©ation/modification
- **Audit** : Marque comme non-conforme (pas de blocage)
- **Append** : Ajoute des propri√©t√©s
- **DeployIfNotExists** : D√©ploie des ressources si conditions

#### Built-in Policies Courantes
- Require tags on resources
- Allowed virtual machine SKUs
- Allowed storage account SKUs
- Require SSL for storage accounts

### 1.4 Management Groups

#### Hi√©rarchie
```
Root Management Group
‚îú‚îÄ‚îÄ Production MG
‚îÇ   ‚îú‚îÄ‚îÄ Prod Subscription 1
‚îÇ   ‚îî‚îÄ‚îÄ Prod Subscription 2
‚îî‚îÄ‚îÄ Development MG
    ‚îú‚îÄ‚îÄ Dev Subscription 1
    ‚îî‚îÄ‚îÄ Test Subscription 1
```

#### Limites
- **6 niveaux** de profondeur maximum
- **10,000 management groups** par tenant
- Chaque subscription dans un seul management group

#### Resource Locks

**üéØ Types de verrous et limitations :**

**Delete Locks**
- **Protection** : Bloque la suppression de ressources
- **Ressources support√©es** : Virtual machines, subscriptions, resource groups
- **Ressources non support√©es** : Management groups, storage account data
- **Usage** : Protection contre suppression accidentelle

**üéØ Points cl√©s identifi√©s :**
- **Delete locks** : Emp√™chent la suppression mais pas la modification
- **Management groups** : Ne peuvent pas √™tre verrouill√©s
- **Storage account data** : Donn√©es non prot√©g√©es par les locks
- **Scope** : Applicable aux VMs, subscriptions, et resource groups uniquement

---

## 2. Implement and Manage Storage (15-20%)

### 2.1 Storage Accounts

#### Types de Storage Accounts

**General Purpose v2 (GPv2) - Standard**
- **Services** : Blobs, Files, Queues, Tables
- **Performance** : Standard (HDD)
- **R√©plication** : Toutes les options (LRS, ZRS, GRS, GZRS, RA-GRS, RA-GZRS)
- **Usage** : Polyvalent, recommand√© pour la plupart des cas

**Premium Block Blobs**
- **Services** : Blobs uniquement
- **Performance** : Premium (SSD)
- **R√©plication** : LRS, ZRS uniquement
- **Usage** : Applications haute performance

**Premium File Shares**
- **Services** : Files uniquement
- **Performance** : Premium (SSD)
- **R√©plication** : LRS, ZRS uniquement
- **Usage** : Partages de fichiers haute performance

**üéØ Erreur identifi√©e :** FileStorage vs autres types
- **Premium File Shares** : Uniquement support√©es par **FileStorage accounts**
- **StorageV2** : Support Standard file shares uniquement
- **BlobStorage** : Aucun support de file shares

#### Niveaux d'acc√®s (Blob Storage)
- **Hot** : Acc√®s fr√©quent, co√ªt stockage √©lev√©, co√ªt acc√®s faible
- **Cool** : Acc√®s occasionnel (30 jours minimum), co√ªt moyen
- **Archive** : Acc√®s rare (180 jours minimum), co√ªt tr√®s faible, latence haute

#### R√©plication et Durabilit√©

**üéØ Points d'attention identifi√©s :**

**Local Redundant Storage (LRS)**
- 3 copies dans le m√™me datacenter
- Durabilit√© : 99.999 999 999% (11 nines)
- Protection : Pannes mat√©rielles

**Zone Redundant Storage (ZRS)**
- 3 copies dans 3 zones de disponibilit√©
- Durabilit√© : 99.9999999999% (12 nines)
- Protection : Panne d'un datacenter entier
- **Limitation** : Pas disponible dans toutes les r√©gions

**Geo-Redundant Storage (GRS)**
- LRS dans r√©gion primaire + 3 copies dans r√©gion secondaire
- Durabilit√© : 99.99999999999999% (16 nines)
- Protection : Panne r√©gionale

**Geo-Zone-Redundant Storage (GZRS)**
- ZRS dans r√©gion primaire + 3 copies dans r√©gion secondaire
- Durabilit√© : 99.99999999999999% (16 nines)
- Protection : Panne r√©gionale + panne de zone
- **Limitation** : Pas disponible dans toutes les r√©gions

**Read-Access GRS (RA-GRS)**
- Comme GRS + acc√®s lecture sur r√©gion secondaire
- Useful pour applications n√©cessitant haute disponibilit√© lecture

**Read-Access GZRS (RA-GZRS)**
- Comme GZRS + acc√®s lecture sur r√©gion secondaire
- Combinaison de haute disponibilit√© et r√©silience g√©ographique

### 2.2 Azure Files

#### Protocoles Support√©s
- **SMB 3.0/3.1** : Windows, Linux, macOS
- **NFS 4.1** : Linux, Premium uniquement
- **REST API** : Acc√®s programmatique

**üéØ Point cl√© identifi√© :** Port SMB
- **Port 445 TCP** obligatoire pour acc√®s SMB
- Doit √™tre ouvert sur les firewalls clients
- N√©cessaire pour mapper des lecteurs r√©seau

#### Types de File Shares
- **Standard** : StorageV2 accounts, performance mod√©r√©e
- **Premium** : FileStorage accounts, haute performance (SSD)

#### Capacit√©s et Limites
- **Standard** : Maximum 5 TB par share
- **Premium** : Maximum 100 TB par share
- **Azure Import/Export** : Support Blob Storage et Azure Files

### 2.3 Blob Storage

#### Types de Blobs
- **Block Blobs** : Fichiers standard (documents, images, vid√©os)
- **Page Blobs** : Disques de machines virtuelles
- **Append Blobs** : Logs, donn√©es ajout√©es s√©quentiellement

#### Lifecycle Management
- **R√®gles automatiques** : Transition entre niveaux
- **Suppression automatique** : Bas√©e sur l'√¢ge
- **Conditions** : Derni√®re modification, derni√®re acc√®s, cr√©ation

### 2.4 Data Transfer Solutions

#### Azure Import/Export Service
**üéØ Destinations support√©es identifi√©es :**
- ‚úÖ **Azure Blob Storage**
- ‚úÖ **Azure Files** (max 5 TB)
- ‚ùå SQL Database, autres services

**Process :**
1. Pr√©parer les disques (BitLocker pour Windows)
2. Cr√©er le job Import/Export
3. Exp√©dier vers datacenter Azure
4. Azure transfert les donn√©es

#### Other Transfer Options
- **AzCopy** : Outil ligne de commande
- **Azure Storage Explorer** : Interface graphique
- **Data Box** : Appliances physiques (TB vers PB)

#### Storage Account Roles et Permissions

**üéØ R√¥les de gestion des comptes de stockage :**

**Storage Account Contributor**
- **Gestion compl√®te** des comptes de stockage
- **Acc√®s aux cl√©s** de compte (Shared Key authorization)
- **Permissions** : Lecture, √©criture, suppression des comptes de stockage
- **Usage** : Administration des comptes de stockage

**Storage Blob Data Contributor**
- **Permissions sur les donn√©es** : Lecture, √©criture, suppression
- **Scope** : Containers et blobs Azure Storage
- **Usage** : Acc√®s aux donn√©es blob sans gestion du compte

**Reader**
- **Lecture seule** : Visualisation de toutes les ressources
- **Aucune modification** : Pas de changements autoris√©s
- **Usage** : Monitoring et audit

**Owner**
- **Acc√®s complet** : Gestion de toutes les ressources
- **D√©l√©gation d'acc√®s** : Possibilit√© d'assigner des r√¥les
- **Usage** : Administration compl√®te

**üéØ Diff√©renciation cl√© identifi√©e :**
- **Storage Account Contributor** : Gestion du compte + acc√®s aux cl√©s
- **Storage Blob Data Contributor** : Acc√®s aux donn√©es uniquement
- **Reader** : Visualisation sans modification
- **Owner** : Contr√¥le total + d√©l√©gation d'acc√®s

---

## 3. Deploy and Manage Azure Compute Resources (20-25%)

### 3.1 Virtual Machines

#### VM Sizes et Families
- **General Purpose** (B, D, DC series) : Workloads √©quilibr√©s
- **Compute Optimized** (F series) : Applications CPU-intensive
- **Memory Optimized** (E, M, G series) : Bases de donn√©es, analytics
- **Storage Optimized** (L series) : Big data, SQL NoSQL
- **GPU** (N series) : IA, machine learning, rendering

#### Disques et Stockage

**üéØ Erreur fr√©quente identifi√©e :** Disques temporaires vs persistants

**Disque C: (OS Disk)**
- **Type** : Persistant (VHD dans Azure Storage)
- **Contenu** : OS, applications install√©es
- **Persistance** : ‚úÖ Conserv√© lors red√©marrages/arr√™ts
- **Usage** : Applications, donn√©es importantes

**Disque D: (Temporary Disk)**
- **Type** : Temporaire (SSD local hyperviseur)
- **Contenu** : Pagefile.sys par d√©faut
- **Persistance** : ‚ùå **PERDU** lors maintenances/red√©ploiements
- **Usage** : Cache, fichiers temporaires, TempDB

**Disques de Donn√©es (E:, F:, etc.)**
- **Type** : Persistants (Managed Disks)
- **Usage** : Donn√©es applicatives, bases de donn√©es

#### Types de Disques
- **Standard HDD** : Workloads peu fr√©quents, co√ªt minimal
- **Standard SSD** : Workloads mod√©r√©s, balance performance/co√ªt
- **Premium SSD** : Workloads critiques, haute performance
- **Ultra Disk** : Workloads extr√™mes, latence ultra-faible

#### High Availability

**Availability Sets**
- **Fault Domains** : Protection pannes mat√©rielles (max 3)
- **Update Domains** : Protection maintenances (max 20)
- **SLA** : 99.95%
- **Scope** : M√™me datacenter

**Availability Zones**
- **Protection** : Datacenters physiquement s√©par√©s
- **SLA** : 99.99%
- **Scope** : R√©gion Azure

**üéØ Pr√©requis identifi√©s pour Availability Zones :**
- **Managed Disks** : Obligatoire
- **Availability Options** : Doit √™tre configur√© √† la cr√©ation

### 3.2 Virtual Machine Scale Sets (VMSS)

#### Concepts Cl√©s
- **Scaling automatique** : Bas√© sur m√©triques ou planning
- **Load balancing** : Int√©gr√© avec Azure Load Balancer
- **Update management** : Rolling updates avec availability

**üéØ Cas d'usage identifi√© :** Maintenance Azure
- Pour garantir **8 VMs minimum** pendant maintenance
- Cr√©er un **VMSS avec 10 instances**
- Azure maintient une partie, les autres restent disponibles

#### Scaling Policies
- **Manual** : Contr√¥le manuel du nombre d'instances
- **Automatic** : Bas√© sur CPU, m√©moire, m√©triques custom
- **Scheduled** : Scaling programm√©

### 3.3 App Services

#### Service Plans
- **Shared** : F1 (Free), D1 (Shared) - Limitations CPU
- **Basic** : B1, B2, B3 - Applications simples
- **Standard** : S1, S2, S3 - Applications production
- **Premium** : P1, P2, P3 - Applications critiques
- **Isolated** : I1, I2, I3 - Environnements d√©di√©s

#### Runtime Stacks et OS
**üéØ Point cl√© identifi√© :** Un App Service = Un runtime
- Chaque App Service configur√© pour **un seul runtime**
- Python OU Java OU C# - pas de mix possible
- Un Plan App Service peut h√©berger plusieurs App Services du m√™me OS

#### Deployment Slots

**üéØ Workflow optimal identifi√© :**
1. **Deploy** ‚Üí D√©ployer l'update sur staging slot
2. **Test** ‚Üí Tester l'application sur staging
3. **Swap** ‚Üí Basculer staging vers production

**Avantages du Slot Swapping :**
- **Zero downtime** : Aucune interruption
- **Warm-up automatique** : Instances pr√©chauff√©es
- **Rollback instant** : Re-swap pour annuler
- **Configuration preservation** : Settings sp√©cifiques aux slots

#### Authentication et Authorization
**üéØ Configuration identifi√©e :** D√©sactiver l'acc√®s anonyme
- Configurer **Authentication** dans App Service
- Ajouter identity providers : Microsoft, Google, Facebook, Twitter
- **Anonymous access** est une m√©thode d'authentification

### 3.4 Azure Container Instances (ACI)

#### Caract√©ristiques
- **Serverless containers** : Pas de gestion d'infrastructure
- **Billing per second** : Facturation √† la seconde
- **Quick start** : D√©marrage en secondes
- **Support** : Linux et Windows containers

#### Use Cases
- **Burst workloads** : Scaling rapide
- **Build agents** : CI/CD pipelines
- **Data processing** : Jobs batch
- **Development/testing** : Environnements temporaires

### 3.5 ARM Templates

#### Structure de Base
```json
{
    "$schema": "...",
    "contentVersion": "1.0.0.0",
    "parameters": {},
    "variables": {},
    "resources": [],
    "outputs": {}
}
```

**üéØ Point identifi√© :** D√©ploiement depuis template
- **Resource Group** : Seul param√®tre configurable lors du d√©ploiement
- Toutes autres configurations d√©finies dans le template
- Template = Infrastructure as Code

---

## 4. Configure and Manage Virtual Networking (25-30%)

### 4.1 Virtual Networks (VNet)

#### Concepts Fondamentaux
- **Address Space** : Plage CIDR priv√©e (10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16)
- **Subnets** : Subdivision du VNet
- **Network Security Groups** : Firewalls au niveau subnet/NIC

#### VNet Peering
- **Regional** : VNets dans la m√™me r√©gion
- **Global** : VNets dans diff√©rentes r√©gions
- **Traffic** : Priv√©, pas d'Internet, faible latence
- **Billing** : Facturation du trafic cross-region

#### DNS Resolution
**üéØ Point identifi√© :** DNS interne Azure
- **Format automatique** : `vm-name.internal.cloudapp.net`
- **Usage** : R√©solution entre VMs dans VNet
- **Custom DNS** : Possibilit√© d'utiliser ses propres serveurs

### 4.2 Network Security Groups (NSG)

#### R√®gles de S√©curit√©
- **Priority** : 100-4096, plus bas = plus prioritaire
- **Direction** : Inbound, Outbound
- **Action** : Allow, Deny

**üéØ Optimisation identifi√©e :**
- **Un NSG peut √™tre associ√© √† plusieurs ressources**
- **5 VMs avec m√™mes r√®gles = 5 NICs + 1 NSG**
- Partage possible entre subnets et NICs

#### Default Rules
**Inbound :**
- Allow VNet traffic
- Allow Azure Load Balancer
- Deny all other traffic

**Outbound :**
- Allow VNet traffic
- Allow Internet traffic
- Deny all other traffic

### 4.3 Load Balancing Solutions

#### Azure Load Balancer (Layer 4)
- **Internal** : Trafic interne au VNet
- **Public** : Trafic depuis Internet
- **Features** : Health probes, NAT rules, HA ports

#### Application Gateway (Layer 7)
- **WAF** : Web Application Firewall
- **SSL termination** : Gestion certificates
- **URL routing** : Routage bas√© sur l'URL
- **Multi-site hosting** : Plusieurs sites web

#### Traffic Manager (DNS-based)
- **Global** : R√©partition g√©ographique
- **Methods** : Performance, Geographic, Weighted, Priority
- **Health monitoring** : Surveillance des endpoints

### 4.4 Network Watcher

**üéØ Points identifi√©s pour l'examen :**

#### Connection Monitor
- **Usage** : Mesurer RTT entre VMs
- **Granularity** : M√©triques par minute
- **Targets** : VM, FQDN, URI, IPv4
- **Protocols** : TCP direct

#### Traffic Analytics
**üéØ Ressources requises identifi√©es :**
1. **Log Analytics Workspace** : Analyse et stockage
2. **Storage Account** : Stockage NSG Flow Logs
3. **NSG Flow Logs** : Source de donn√©es activ√©e

**Pr√©requis :** M√™me r√©gion pour tous les composants

#### Other Features
- **IP Flow Verify** : Tester r√®gles NSG
- **Next Hop** : Routing troubleshooting
- **Packet Capture** : Capture de paquets sur VMs

### 4.5 VPN et ExpressRoute

#### Site-to-Site VPN
- **Virtual Network Gateway** : Passerelle Azure
- **Local Network Gateway** : Repr√©sentation on-premises
- **Connection** : Lien entre les gateways
- **Protocols** : IKEv1, IKEv2, SSTP

#### Point-to-Site VPN
- **Client certificates** : Authentification par certificat
- **Azure AD authentication** : Authentification moderne
- **RADIUS** : Authentification externe

#### ExpressRoute
- **Private connectivity** : Connexion priv√©e d√©di√©e
- **No Internet** : Pas de transit par Internet
- **Higher bandwidth** : Jusqu'√† 100 Gbps
- **Lower latency** : Latence pr√©visible

---

## 5. Monitor and Backup Azure Resources (10-15%)

### 5.1 Azure Monitor

#### Architecture
- **Data Collection** : M√©triques, logs, traces
- **Storage** : Metrics store, Log Analytics workspace
- **Analysis** : KQL queries, workbooks, dashboards
- **Actions** : Alerts, autoscale, automation

#### Cost Management et Budgets

**üéØ Configuration des budgets et actions automatiques :**

**Processus d'√©dition de budget :**
1. **Cost Management + Billing** ‚Üí **Budgets**
2. **√âditer le budget** associ√© aux ressources du groupe de ressources
3. **Cr√©er un nouveau Action Group** de type **Runbook**
4. **Choisir "Stop VM"** comme action

**üéØ Points cl√©s identifi√©s :**
- **Cost analysis** : Ne peut pas arr√™ter automatiquement les VMs
- **Scale Up VM action group** : Non requis pour arr√™ter les VMs
- **Runbook type** : Obligatoire pour actions d'automatisation
- **Stop VM action** : Action sp√©cifique pour arr√™ter les machines virtuelles

**üéØ Azure Advisor - Cost Optimization :**
- **Cost blade** : Optimisation et r√©duction des d√©penses Azure
- **Identification** : VMs sous-utilis√©es
- **Performance blade** : Am√©lioration de la vitesse des applications
- **High availability** : Non disponible via Azure Advisor
- **Operational Excellence** : Efficacit√© des processus et workflows, gestion des ressources, meilleures pratiques de d√©ploiement

**üéØ Concept cl√© identifi√© :** Target Resource pour alertes
- **VM Events/Syslog** ‚Üí Target = **Log Analytics Workspace**
- **VM Metrics** ‚Üí Target = **Virtual Machine**
- Les VMs envoient logs vers Log Analytics pour analyse

#### Types d'Alertes

**Metric Alerts**
- **Seuils num√©riques** : CPU > 80%
- **Near real-time** : √âvaluation fr√©quente
- **Multiple dimensions** : Filtrage par propri√©t√©s

**Log Alerts**
- **KQL queries** : Requ√™tes sur logs
- **Example** : `Event | search "error"`
- **Flexibility** : Logique complexe possible

**Activity Log Alerts**
- **Administrative events** : Cr√©ation/suppression ressources
- **Service Health** : Incidents Azure
- **Resource Health** : √âtat des ressources

#### Requ√™tes KQL Essentielles
```kusto
// Rechercher dans une table sp√©cifique
Event | search "error"

// Compter par computer
Event | summarize count() by Computer

// Filtrer par niveau
Event | where EventLevelName == "Error"

// Timeline des √©v√©nements
Event | where TimeGenerated > ago(1h) | sort by TimeGenerated desc
```

### 5.2 Azure Backup

#### Recovery Services Vault

**üéØ R√®gles critiques identifi√©es :**

**Localisation :**
- Vault et ressources **dans la m√™me r√©gion**
- Example : Vault2 (West US) peut sauvegarder Storage1 (West US)
- Share1 sauvegardable car dans Storage1 m√™me r√©gion

**Suppression du Vault :**
1. **D'abord** : Arr√™ter backup de tous les √©l√©ments prot√©g√©s
2. **Ensuite** : Supprimer le vault
3. **Erreur** : Vault ne peut pas √™tre supprim√© avec √©l√©ments prot√©g√©s

#### Backup Policies

**üéØ Limites par type de ressource :**
- **VMs** : Maximum 100 VMs par policy
- **SQL Databases** : Policy s√©par√©e requise
- **File Shares** : Policy s√©par√©e requise

**Example :** 100 VMs + 20 SQL + 50 Files = **3 policies minimum**

#### Changement de Vault

**Pour Backup :**
1. Arr√™ter backup dans vault actuel (RSV1)
2. Configurer backup dans nouveau vault (RSV2)

**Pour Site Recovery :**
- VM ‚Üí Disaster Recovery ‚Üí Replication Settings ‚Üí Nouveau vault

#### Types de Backup
- **Azure VMs** : Snapshots dans r√©gion source
- **On-premises** : MARS agent ou DPM/MABS
- **SQL in Azure VM** : Application-consistent backups
- **Azure Files** : Snapshots au niveau share

### 5.3 Azure Site Recovery

#### Supported Scenarios
- **Azure to Azure** : VMs entre r√©gions Azure
- **VMware to Azure** : VMs VMware vers Azure
- **Hyper-V to Azure** : VMs Hyper-V vers Azure
- **Physical to Azure** : Serveurs physiques vers Azure

#### Components
- **Recovery Services Vault** : Orchestration et management
- **Configuration Server** : Pour VMware (on-premises)
- **Process Server** : R√©plication data processing
- **Master Target** : Receive replication data

#### Recovery Plans
- **Grouping** : VMs dans groupes logiques
- **Sequencing** : Ordre de d√©marrage
- **Scripts** : Automation pendant failover
- **Manual actions** : Actions manuelles requises

---

## üéØ Points Critiques Bas√©s sur Vos Erreurs

### 1. Log Analytics = Hub Central pour Monitoring
**‚ùå Erreur courante :** Choisir la VM comme target resource
**‚úÖ Correct :** Log Analytics Workspace pour toutes les alertes de logs
- Windows Event Logs ‚Üí Log Analytics
- Linux Syslog ‚Üí Log Analytics
- VM metrics ‚Üí VM directement

### 2. R√®gle de M√™me R√©gion
**‚ùå Erreur :** Vault et Storage dans r√©gions diff√©rentes
**‚úÖ Correct :** Toujours m√™me r√©gion pour :
- Recovery Services Vault + Storage Account
- Traffic Analytics components
- Backup sources et destinations

### 3. Disque D: = Temporaire et Volatil
**‚ùå Erreur :** Stocker des donn√©es importantes sur D:
**‚úÖ Correct :** D: pour cache/temp uniquement
- C: = Persistant (OS, apps)
- D: = Temporaire (perdu lors maintenance)
- E:, F: = Persistants (donn√©es)

### 4. Storage Account Types et Limitations
**‚ùå Erreur :** Premium File Shares sur StorageV2
**‚úÖ Correct :** FileStorage accounts uniquement
- StorageV2 = Standard files uniquement
- BlobStorage = Pas de files du tout

### 5. NSG Sharing et Optimisation
**‚ùå Erreur :** Un NSG par VM
**‚úÖ Correct :** Un NSG partag√© si m√™mes r√®gles
- 5 VMs = 5 NICs + 1 NSG (optimal)

### 6. Recovery Services Vault Management
**‚ùå Erreur :** Essayer supprimer vault avec backups actifs
**‚úÖ Correct :** Toujours arr√™ter backups d'abord
- Stop backup ‚Üí Delete vault
- Change vault = Stop + Start elsewhere

### 7. App Service Deployment Workflow
**‚ùå Erreur :** Deploy direct en production
**‚úÖ Correct :** Deploy ‚Üí Test ‚Üí Swap
- Staging slot pour tests
- Production swap pour zero downtime

### 8. Root Management Group Access
**‚ùå Erreur :** Acc√®s direct au root MG
**‚úÖ Correct :** Global Admin + elevation required
- Aucun acc√®s par d√©faut
- Global Admin doit s'√©lever

---

## ‚úÖ Checklist Final d'Examen

### Identities and Governance
- [ ] Dynamic group rules syntax : `(user.property -eq "value")`
- [ ] Custom domain DNS records : TXT ou MX
- [ ] Root MG access : Global Admin + elevation
- [ ] RBAC scopes : MG ‚Üí Subscription ‚Üí RG ‚Üí Resource

### Storage
- [ ] FileStorage pour Premium files uniquement
- [ ] Import/Export destinations : Blob + Files (5TB max)
- [ ] Replication types par account type
- [ ] Port 445 pour Azure Files SMB

### Compute
- [ ] Disque D: temporaire, C: persistant
- [ ] VMSS pour high availability pendant maintenance
- [ ] Template deployment : Resource Group configurable
- [ ] Availability Zones : Managed disks requis

### Networking
- [ ] NSG sharing entre ressources
- [ ] DNS interne : vm-name.internal.cloudapp.net
- [ ] Traffic Analytics : Log Analytics + Storage Account
- [ ] Connection Monitor pour RTT measurements

### Monitoring & Backup
- [ ] Log Analytics Workspace comme target pour VM alerts
- [ ] Backup policies : 100 VMs max par policy
- [ ] Recovery Services Vault : m√™me r√©gion
- [ ] Stop backup avant delete vault
- [ ] KQL syntax : `Table | search "term"`

---

## üìö Ressources d'√âtude Recommand√©es

### Documentation Microsoft
- Azure Architecture Center
- Azure Well-Architected Framework
- Azure Best Practices

### Labs Pratiques
- Microsoft Learn modules
- Azure free account (12 mois)
- Hands-on labs

### Examens Blancs
- MeasureUp practice tests
- Whizlabs Azure exams
- Tutorials Dojo practice tests

**Temps de pr√©paration recommand√© :** 40-60 heures d'√©tude + practice labs