## 1.3 Azure Policy

### Concepts ClÃ©s
- **Policy Definition** : RÃ¨gle de conformitÃ©
- **Policy Assignment** : Application d'une policy Ã  un scope
- **Initiative** : Collection de policies
- **Compliance** : Ã‰tat de conformitÃ© des ressources

### Effects Principaux - DÃ©taillÃ©

**âš ï¸ Erreur Courante QCM : DiffÃ©rence entre Deny et Audit**

| Effet | Action | Quand utiliser |
|-------|--------|----------------|
| **Deny** | âŒ **BLOQUE** la crÃ©ation/modification | Standards stricts, compliance obligatoire |
| **Audit** | âœ… Permet mais **LOG** comme non-compliant | Identifier les ressources non conformes |
| **Append** | Ajoute des propriÃ©tÃ©s manquantes | Tags automatiques |
| **Modify** | Modifie des propriÃ©tÃ©s existantes | Corriger configurations |
| **DeployIfNotExists** | DÃ©ploie une ressource si absente | Agents de monitoring |
| **AuditIfNotExists** | Audit si ressource absente | VÃ©rifier prÃ©sence de sÃ©curitÃ© |

**DiffÃ©rence ClÃ© Deny vs Audit :**

**Deny - PrÃ©vention (Enforcement)**
- âŒ **Bloque AVANT** la crÃ©ation de la ressource
- âœ… **Assure compliance dÃ¨s le dÃ©part**
- **Use case** : EmpÃªcher crÃ©ation de VMs sans tags, bloquer rÃ©gions non autorisÃ©es
- **Impact** : Les utilisateurs ne peuvent PAS crÃ©er de ressources non conformes

**Audit - DÃ©tection (Visibility)**
- âœ… **Permet la crÃ©ation**, mais log comme non-compliant
- ðŸ“Š **Identifie les ressources** Ã  corriger plus tard
- **Use case** : DÃ©couvrir les ressources existantes non conformes, phase de test
- **Impact** : Les ressources sont crÃ©Ã©es, mais marquÃ©es pour rÃ©vision

**Exemple Pratique - Bloquer VMs sans tag "Environment" :**

```json
{
  "mode": "Indexed",
  "policyRule": {
    "if": {
      "allOf": [
        {
          "field": "type",
          "equals": "Microsoft.Compute/virtualMachines"
        },
        {
          "field": "tags['Environment']",
          "exists": "false"
        }
      ]
    },
    "then": {
      "effect": "deny"
    }
  }
}
```

**Assigner une policy avec effet Deny :**
```bash
az policy assignment create \
  --name "require-environment-tag" \
  --policy "/subscriptions/xxx/providers/Microsoft.Authorization/policyDefinitions/xxx" \
  --scope "/subscriptions/xxx" \
  --params '{"effect": {"value": "Deny"}}'
```

**ScÃ©narios d'examen :**
- **"Prevent users from..."** â†’ Utiliser **Deny**
- **"Identify resources that..."** â†’ Utiliser **Audit**
- **"Automatically add tags..."** â†’ Utiliser **Append**
- **"Deploy monitoring agent if missing..."** â†’ Utiliser **DeployIfNotExists**

### Built-in Policies Courantes
- Require tags on resources
- Allowed virtual machine SKUs
- Allowed storage account SKUs
- Require SSL for storage accounts

