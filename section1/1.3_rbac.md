## 1.3 Role-Based Access Control (RBAC)

### Rôles Built-in Essentiels

**⚠️ Principe du Moindre Privilège :** Toujours utiliser le rôle avec le minimum de permissions requis

**Rôles Azure RBAC (Gestion des Ressources) :**

**Owner**
- **Permissions** : Accès complet à toutes les ressources
- **Capacités** : Création, modification, suppression + délégation d'accès
- **Usage** : Administration complète avec gestion des accès
- **Scope** : Ressources Azure (VMs, Storage, Networks, etc.)

**Contributor**
- **Permissions** : Accès complet aux ressources
- **Limitation** : ❌ Ne peut PAS déléguer l'accès à d'autres utilisateurs
- **Usage** : Développement et administration des ressources sans gestion des accès
- **Scope** : Tous types de ressources Azure

**Reader**
- **Permissions** : Lecture seule
- **Limitation** : ❌ Aucune action de modification autorisée
- **Usage** : Monitoring, audit, consultation
- **Scope** : Visualisation des ressources existantes

**User Access Administrator**
- **Permissions** : Gestion des accès uniquement
- **Limitation** : ❌ Ne peut PAS créer/modifier les ressources
- **Usage** : Délégation des permissions RBAC
- **Scope** : Assignations de rôles uniquement

### Rôles Administratifs Azure AD (Gestion des Identités)

**User Administrator**
- **Permissions** : Création et gestion des utilisateurs et groupes
- **Capacités** : Gestion des tickets de support, monitoring de la santé des services
- **Usage** : Administration dédiée aux utilisateurs sans privilèges excessifs
- **Scope** : Gestion des identités uniquement
- **✅ Recommandé** : Pour gestion quotidienne des utilisateurs

**Global Administrator**
- **Permissions** : Accès complet à toutes les fonctionnalités Azure AD
- **Capacités** : Plus de permissions que nécessaire pour la gestion basique
- **Usage** : Administration complète du tenant
- **⚠️ Attention** : Utiliser avec parcimonie, trop de permissions pour tà¢ches simples

**Billing Administrator**
- **Permissions** : Gestion des aspects financiers et de facturation
- **Capacités** : Achats, abonnements, gestion des coûts
- **Usage** : Administration financière
- **Scope** : Facturation et finances uniquement

**Service Administrator (Classic)**
- **Type** : Rôle classique (Legacy)
- **Permissions** : Accès complet aux services Azure
- **⚠️ Deprecated** : Remplacé par les rôles RBAC modernes
- **Usage** : Non recommandé pour nouvelles installations

### Rôles Spécialisés

**Rôles Ressources Spécifiques :**
- **Virtual Machine Contributor** : Gestion complète des VMs
- **Storage Account Contributor** : Gestion des comptes de stockage
- **Network Contributor** : Gestion des ressources réseau
- **API Management Service Contributor** : Configuration et maintenance des APIs

**⚠️ Comparaison pour l'Examen :**

| Besoin | Rôle Approprié | Raison |
|--------|---------------|--------|
| Gérer utilisateurs et groupes | **User Administrator** | Moindre privilège suffisant |
| Créer et gérer VMs | **Contributor** ou **VM Contributor** | Pas besoin de gestion d'accès |
| Consulter les ressources | **Reader** | Lecture seule |
| Gérer les permissions | **Owner** ou **User Access Administrator** | Délégation requise |
| Administration complète tenant | **Global Administrator** | Privilèges maximum |

### Scopes d'assignation RBAC - Détaillé

**⚠️ Erreur Courante QCM : Niveaux d'assignation et héritage**

**Hiérarchie des Scopes (du plus large au plus précis) :**

```
Management Group (Racine)
    â†“ (héritage automatique vers le bas)
Subscriptions
    â†“ (héritage automatique vers le bas)
Resource Groups
    â†“ (héritage automatique vers le bas)
Resources (VM, Storage, VNet, etc.)
```

**✅ Principe d'Héritage RBAC :**
- Rôle au **Management Group** → S'applique à **toutes** les subscriptions et ressources sous-jacentes
- Rôle à la **Subscription** → S'applique à **tous** les Resource Groups et ressources
- Rôle au **Resource Group** → S'applique à **toutes** les ressources du groupe
- Rôle à une **Resource** → S'applique **uniquement** à cette ressource

**Exemples Pratiques :**

```bash
# 1. Niveau Subscription - Accès à TOUS les Resource Groups
az role assignment create \
  --assignee user@contoso.com \
  --role "Contributor" \
  --scope "/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

# 2. Niveau Resource Group - Accès à TOUTES les ressources du RG
az role assignment create \
  --assignee user@contoso.com \
  --role "Virtual Machine Contributor" \
  --resource-group "Production-RG"

# 3. Niveau Resource - Accès SEULEMENT à cette VM spécifique
az role assignment create \
  --assignee user@contoso.com \
  --role "Virtual Machine Contributor" \
  --scope "/subscriptions/xxx/resourceGroups/Production-RG/providers/Microsoft.Compute/virtualMachines/VM1"
```

**Scénarios d'Examen :**

| Besoin | Scope | Justification |
|--------|-------|---------------|
| Gérer toutes les VMs de l'entreprise | Management Group | Accès multi-subscriptions |
| Gérer toutes les ressources d'un environnement | Subscription | Accès à tous les RGs |
| Gérer les ressources d'un projet | Resource Group | Limité au projet |
| Gérer une VM critique | Resource | Accès ultra-restreint |

**⚠️ Best Practice - Least Privilege :**
- ✅ TOUJOURS assigner au scope le **plus restreint** possible
- ❌ ÉVITER Owner/Contributor au niveau Subscription
- ✅ UTILISER des rôles spécifiques (Storage Blob Data Contributor, etc.)

**Validation des assignations :**
```bash
# Lister les assignations d'un utilisateur
az role assignment list --assignee user@contoso.com --output table

# Vérifier les permissions sur une ressource
az role assignment list --scope "/subscriptions/xxx/resourceGroups/myRG"
```