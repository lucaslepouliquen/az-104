### 3.3 App Services

#### Service Plans - Tiers D√©taill√©s

**‚ö†Ô∏è Erreur Courante QCM : Capacit√©s de scaling par tier**

**Comparaison Compl√®te des Tiers :**

| Tier | SKUs | Max Instances | Autoscale | Deployment Slots | Custom Domain | SSL | Prix/mois* |
|------|------|---------------|-----------|------------------|---------------|-----|-----------|
| **Free** | F1 | 1 (partag√©) | ‚ùå Non | ‚ùå Non | ‚ùå Non | ‚ùå Non | Gratuit |
| **Shared** | D1 | 1 (partag√©) | ‚ùå Non | ‚ùå Non | ‚úÖ Oui | ‚ùå Non | ~$10 |
| **Basic** | B1-B3 | 3 | ‚ùå Non | ‚ùå Non | ‚úÖ Oui | ‚úÖ Oui | ~$55-220 |
| **Standard** | S1-S3 | 10 | ‚úÖ Oui | ‚úÖ 5 slots | ‚úÖ Oui | ‚úÖ Oui | ~$70-280 |
| **Premium** | P1v2-P3v2 | 30 | ‚úÖ Oui | ‚úÖ 20 slots | ‚úÖ Oui | ‚úÖ Oui | ~$150-600 |
| **PremiumV3** | P1v3-P3v3 | 30 | ‚úÖ Oui | ‚úÖ 20 slots | ‚úÖ Oui | ‚úÖ Oui | ~$200-800 |
| **Isolated** | I1-I3 | 100 | ‚úÖ Oui | ‚úÖ 20 slots | ‚úÖ Oui | ‚úÖ Oui | ~$650+ |

**\*Prix indicatifs** : Prix approximatifs pour la r√©gion US East. Les tarifs varient selon les r√©gions Azure et changent fr√©quemment. Consultez la [page officielle de tarification Azure App Service](https://azure.microsoft.com/pricing/details/app-service/) pour les prix actuels de votre r√©gion.

**Caract√©ristiques par Tier :**

**Free / Shared (Development) :**
- **Infrastructure** : Partag√©e avec autres clients
- **Limitations** : Quotas CPU (60 min/jour pour Free)
- **Downtime** : Possible si app inactive > 20 min
- **Use case** : D√©veloppement, POC uniquement
- ‚ùå **Production** : Non recommand√©

**Basic (Small Production) :**
- **Infrastructure** : VMs d√©di√©es
- **Scaling** : Manuel uniquement (1-3 instances)
- **Limitations** : Pas d'autoscale, pas de slots
- **Use case** : Petites apps production, budget limit√©
- **SLA** : 99.95%

**Standard (Production) :**
- **Infrastructure** : VMs d√©di√©es
- **Scaling** : Manuel + Autoscale (1-10 instances)
- **Features** : Deployment slots (5), Traffic Manager
- **Use case** : Apps production standard
- **SLA** : 99.95%

**Premium (High Performance) :**
- **Infrastructure** : VMs d√©di√©es plus puissantes
- **Scaling** : Manuel + Autoscale (1-30 instances)
- **Features** : Deployment slots (20), VNet integration
- **Use case** : Apps critiques, haute performance
- **SLA** : 99.95%

**Isolated (Enterprise) :**
- **Infrastructure** : App Service Environment (ASE) d√©di√©
- **Isolation** : R√©seau isol√©, pas de partage
- **Scaling** : Jusqu'√† 100 instances
- **Use case** : Conformit√©, s√©curit√© maximale
- **SLA** : 99.95%

#### App Service Plan Scaling - D√©taill√©

**‚ö†Ô∏è Erreur Courante QCM : Scale Up vs Scale Out**

**Types de Scaling Disponibles :**

**1. Scale Up (Vertical Scaling) - Changer de Tier/SKU**

**D√©finition :** Augmenter les ressources (CPU, RAM, Storage) de chaque instance

**Quand utiliser :**
- Application n√©cessite plus de CPU/RAM
- Atteinte des limites de l'instance actuelle
- Besoin de nouvelles fonctionnalit√©s (ex: deployment slots)

**Exemple - Azure CLI :**
```bash
# Upgrader de B1 vers S1
az appservice plan update \
  --name myAppServicePlan \
  --resource-group myRG \
  --sku S1

# Upgrader vers Premium
az appservice plan update \
  --name myAppServicePlan \
  --resource-group myRG \
  --sku P1V2
```

**Impact :**
- ‚è±Ô∏è **Downtime** : Bref red√©marrage (quelques secondes)
- üí∞ **Co√ªt** : Augmente selon le nouveau tier
- üéØ **Performance** : Chaque instance plus puissante

**2. Scale Out (Horizontal Scaling) - Ajouter des Instances**

**D√©finition :** Augmenter le nombre d'instances (VMs) qui ex√©cutent l'application

**Quand utiliser :**
- Trafic √©lev√©, besoin de plus de capacit√©
- Haute disponibilit√© requise
- Distribution de charge

**Exemple - Azure CLI :**
```bash
# Scale Out manuel - Ajouter 5 instances
az appservice plan update \
  --name myAppServicePlan \
  --resource-group myRG \
  --number-of-workers 5
```

**Impact :**
- ‚è±Ô∏è **Downtime** : ‚úÖ Aucun
- üí∞ **Co√ªt** : Proportionnel au nombre d'instances
- üéØ **Performance** : Capacit√© totale multipli√©e

**3. Autoscale (Automatic Horizontal Scaling)**

**Disponible √† partir de :** Standard (S1) et sup√©rieur

**Configuration Autoscale :**
```bash
# Cr√©er une r√®gle d'autoscale
az monitor autoscale create \
  --resource-group myRG \
  --resource myAppServicePlan \
  --resource-type Microsoft.Web/serverFarms \
  --name myAutoscaleRule \
  --min-count 2 \
  --max-count 10 \
  --count 2

# R√®gle bas√©e sur CPU (Scale Out)
az monitor autoscale rule create \
  --resource-group myRG \
  --autoscale-name myAutoscaleRule \
  --condition "CpuPercentage > 75 avg 5m" \
  --scale out 1

# R√®gle bas√©e sur CPU (Scale In)
az monitor autoscale rule create \
  --resource-group myRG \
  --autoscale-name myAutoscaleRule \
  --condition "CpuPercentage < 25 avg 5m" \
  --scale in 1
```

**M√©triques disponibles pour Autoscale :**
- **CPU Percentage** : % utilisation CPU
- **Memory Percentage** : % utilisation RAM
- **Disk Queue Length** : File d'attente disque
- **Http Queue Length** : File d'attente requ√™tes HTTP
- **Data In/Out** : Bande passante r√©seau
- **Custom metrics** : Application Insights

**Configuration via Portal :**
```
App Service Plan ‚Üí Scale out (App Service plan) ‚Üí Autoscale
‚Üí Add a rule ‚Üí Metric (CPU Percentage > 70)
‚Üí Operation (Increase count by 1)
‚Üí Cool down (5 minutes)
```

**Best Practices Autoscale :**
- ‚úÖ **Minimum 2 instances** pour haute disponibilit√©
- ‚úÖ **Cool down period** : 5-10 minutes (√©viter flapping)
- ‚úÖ **Margins** : Scale out √† 70%, scale in √† 30%
- ‚ö†Ô∏è **Limites** : D√©finir max instances pour contr√¥ler co√ªts

**Matrice de D√©cision - Scaling :**

| Sympt√¥me | Solution | Commande |
|----------|----------|----------|
| **CPU/RAM satur√©** sur instances | Scale Up | Change SKU (B1‚ÜíS1) |
| **Trafic √©lev√©**, instances satur√©es | Scale Out | Augmenter instances |
| **Trafic variable** (pics) | Autoscale | R√®gles bas√©es m√©triques |
| **Besoin de deployment slots** | Scale Up | Upgrade vers S1+ |
| **Latence √©lev√©e** | Scale Out | Plus d'instances |
| **Co√ªts trop √©lev√©s** | Scale Down/In | R√©duire tier ou instances |

**Limitations par Tier :**

| Tier | Scale Out Manuel | Autoscale | Max Instances |
|------|-----------------|-----------|---------------|
| Free/Shared | ‚ùå Non | ‚ùå Non | 1 (partag√©) |
| Basic | ‚úÖ Oui | ‚ùå Non | 3 |
| Standard | ‚úÖ Oui | ‚úÖ Oui | 10 |
| Premium | ‚úÖ Oui | ‚úÖ Oui | 30 |
| Isolated | ‚úÖ Oui | ‚úÖ Oui | 100 |

**Sc√©narios d'Examen :**

| Question | R√©ponse | Raison |
|----------|---------|--------|
| App n√©cessite plus de RAM | **Scale Up** | Augmenter ressources par instance |
| Trafic web √©lev√©, pic de charge | **Scale Out** | Ajouter instances pour capacit√© |
| Besoin deployment slots | **Scale Up to Standard** | Slots disponibles √† partir de S1 |
| Trafic variable jour/nuit | **Autoscale** | Ajustement automatique |
| Minimiser downtime pendant scaling | **Scale Out** | Pas de red√©marrage |

**PowerShell - Gestion Compl√®te :**
```powershell
# Scale Up
Set-AzAppServicePlan `
  -ResourceGroupName "myRG" `
  -Name "myAppServicePlan" `
  -Tier "Standard" `
  -WorkerSize "Medium"

# Scale Out
Set-AzAppServicePlan `
  -ResourceGroupName "myRG" `
  -Name "myAppServicePlan" `
  -NumberofWorkers 5

# Get current scale
Get-AzAppServicePlan `
  -ResourceGroupName "myRG" `
  -Name "myAppServicePlan" | 
  Select-Object Name, Sku, NumberOfWorkers
```

#### Runtime Stacks et OS
** Point cl√© identifi√© :** Un App Service = Un runtime
- Chaque App Service configur√© pour **un seul runtime**
- Python OU Java OU C# - pas de mix possible
- Un Plan App Service peut h√©berger plusieurs App Services du m√™me OS

#### Deployment Slots

** Workflow optimal identifi√© :**
1. **Deploy** ‚Üí D√©ployer l'update sur staging slot
2. **Test** ‚Üí Tester l'application sur staging
3. **Swap** ‚Üí Basculer staging vers production

**Avantages du Slot Swapping :**
- **Zero downtime** : Aucune interruption
- **Warm-up automatique** : Instances pr√©chauff√©es
- **Rollback instant** : Re-swap pour annuler
- **Configuration preservation** : Settings sp√©cifiques aux slots

#### Authentication et Authorization

**‚ö†Ô∏è Erreur Courante QCM : Comprendre Anonymous Access**

**Anonymous Access n'est PAS une m√©thode d'authentification** - c'est l'**ABSENCE** d'authentification.

**M√©thodes d'Authentification Disponibles :**
- ‚úÖ **Microsoft Entra ID (Azure AD)** : Authentification Azure AD
- ‚úÖ **Microsoft Account** : Comptes personnels Microsoft
- ‚úÖ **Facebook** : Authentification via Facebook
- ‚úÖ **Google** : Authentification via Google
- ‚úÖ **Twitter** : Authentification via Twitter
- ‚ùå **Anonymous Access** : Pas d'authentification (acc√®s public par d√©faut)

**Configuration - D√©sactiver l'Acc√®s Anonyme :**

Par d√©faut, App Service permet l'acc√®s anonyme (sans authentification). Pour s√©curiser votre application :

```bash
# Configurer l'authentification avec Azure AD
az webapp auth update \
  --resource-group myRG \
  --name myWebApp \
  --enabled true \
  --action LoginWithAzureActiveDirectory \
  --aad-client-id {client-id}
```

**Via Azure Portal :**
```
App Service ‚Üí Authentication/Authorization
‚Üí App Service Authentication: On
‚Üí Action when request is not authenticated: Log in with Azure Active Directory
‚Üí Authentication Providers: Configure providers
```

**Actions Disponibles :**
- **Allow Anonymous requests (no action)** : Acc√®s public autoris√©
- **Log in with [Provider]** : Redirection vers authentification
- **Return 401 Unauthorized** : Rejeter les requ√™tes non authentifi√©es

